{"version":3,"sources":["../../src/query/query-queue.js"],"names":["Queue","require","FastMemoryStore","jobHandler","makeBaseOptions","concurrent","store","defaultPostHandler","queryJob","result","create","postHandler","betterQueueOptions","queueOptions","queue","callback","err","console","log","module","exports"],"mappings":";;;;;;AAAA,MAAMA,KAAK,GAAGC,OAAO,CAAE,cAAF,CAArB;;AAEA,MAAMC,eAAe,GAAGD,OAAO,CAAE,6BAAF,CAA/B;;AACA,MAAME,UAAU,GAAGF,OAAO,CAAE,eAAF,CAA1B;;AAEA,MAAMG,eAAe,GAAG,MAAM;AAC5B,SAAO;AACLC,IAAAA,UAAU,EAAE,CADP;AAELC,IAAAA,KAAK,EAAEJ,eAAe;AAFjB,GAAP;AAID,CALD;;AAOA,MAAMK,kBAAkB,GAAG,CAAC;AAAEC,EAAAA,QAAF;AAAYC,EAAAA;AAAZ,CAAD,KAA0BA,MAArD;;AAEA,MAAMC,MAAM,GAAG,CAAC;AACdC,EAAAA,WAAW,GAAGJ,kBADA;AAEdK,EAAAA,kBAAkB,GAAG;AAFP,IAGZ,EAHW,KAGJ;AACT,QAAMC,YAAY,qBAAQT,eAAR,EAA4BQ,kBAA5B,CAAlB;AACA,QAAME,KAAK,GAAG,IAAId,KAAJ;AAAA;AAAA;AAAA,+CAAU,WAAOQ,QAAP,EAAiBO,QAAjB,EAA8B;AACpD,UAAI;AACF,cAAMN,MAAM,SAASN,UAAU,CAAC;AAAEK,UAAAA;AAAF,SAAD,CAA/B;AACAG,QAAAA,WAAW,CAAC;AAAEH,UAAAA,QAAF;AAAYC,UAAAA;AAAZ,SAAD,CAAX;AACAM,QAAAA,QAAQ,CAAC,IAAD,EAAON,MAAP,CAAR;AACD,OAJD,CAIE,OAAOO,GAAP,EAAY;AACZC,QAAAA,OAAO,CAACC,GAAR,CAAa,2BAAb,EAAyCF,GAAzC;AACAD,QAAAA,QAAQ,CAACC,GAAD,CAAR;AACD;AACF,KATa;;AAAA;AAAA;AAAA;AAAA,OASXH,YATW,CAAd;AAUA,SAAOC,KAAP;AACD,CAhBD;;AAkBAK,MAAM,CAACC,OAAP,GAAiB;AACfV,EAAAA;AADe,CAAjB","sourcesContent":["const Queue = require(`better-queue`)\n\nconst FastMemoryStore = require(`./better-queue-custom-store`)\nconst jobHandler = require(`./job-handler`)\n\nconst makeBaseOptions = () => {\n  return {\n    concurrent: 4,\n    store: FastMemoryStore(),\n  }\n}\n\nconst defaultPostHandler = ({ queryJob, result }) => result\n\nconst create = ({\n  postHandler = defaultPostHandler,\n  betterQueueOptions = {},\n} = {}) => {\n  const queueOptions = { ...makeBaseOptions, ...betterQueueOptions }\n  const queue = new Queue(async (queryJob, callback) => {\n    try {\n      const result = await jobHandler({ queryJob })\n      postHandler({ queryJob, result })\n      callback(null, result)\n    } catch (err) {\n      console.log(`Error running queryRunner`, err)\n      callback(err)\n    }\n  }, queueOptions)\n  return queue\n}\n\nmodule.exports = {\n  create,\n}\n"],"file":"query-queue.js"}